<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="Description" content="Enter your description here" />
    <title>eVyapaar</title>
    <link rel="stylesheet" href="./node_modules/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="./node_modules/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href=".assets/css/style.css">
    <!-- Custom styles for this template-->
    <link href=".assets/css/sb-admin-2.min.css" rel="stylesheet">
    <script src="./node_modules/jquery/dist/jquery.min.js"></script>
    <script src="./node_modules/popper.js/dist/umd/popper.min.js"></script>
    <script src="./node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
</head>

<body>
    <div class="page">
        <div style="height: 100vh;" class=" d-flex flex-column align-items-center justify-content-center">
            <img src=".assets/img/evyapaar.png" class="mb-3 init-logo" height="250px" alt="">
            <p class="h3 font-weight-light">Welcome To E-Vyapaar</p>
            <img src=".assets/img/loader.gif" class="mb-3 init-loader" height="150px" alt="">
        </div>
    </div>
    <script>
        // $('.init-logo').slideDown();
        // $('.init-loader').slideUp();
        // $('.init-loader-mini').slideDown();
        $(document).ready(function () {
        })
    </script>
    <script>

        function dt() {
            if (!$('.data-table').hasClass('dataTable')) {
                var table = $('.data-table').DataTable({
                    dom: 'Bfrtip',
                    colReorder: true,
                    fixedHeader: true,
                    // responsive: true,
                    // keys: true,
                    buttons: [{
                        extend: 'colvis',
                        className: 'btn btn-primary btn-sm',
                        init: function (api, node, config) {
                            $(node).removeClass('btn-secondary')
                        }
                    },
                    {
                        extend: 'pageLength',
                        className: 'btn btn-primary btn-sm',
                        init: function (api, node, config) {
                            $(node).removeClass('btn-secondary')
                        }
                    },
                    {
                        extend: 'copyHtml5',
                        exportOptions: {
                            columns: ':visible'
                        },
                        className: 'btn btn-dark btn-sm',
                        init: function (api, node, config) {
                            $(node).removeClass('btn-secondary')
                        }
                    },
                    {
                        extend: 'excelHtml5',
                        exportOptions: {
                            columns: ':visible'
                        },
                        className: 'btn btn-success btn-sm',
                        init: function (api, node, config) {
                            $(node).removeClass('btn-secondary')
                        }
                    },
                    {
                        extend: 'csvHtml5',
                        exportOptions: {
                            columns: ':visible'
                        },
                        className: 'btn btn-info btn-sm',
                        init: function (api, node, config) {
                            $(node).removeClass('btn-secondary')
                        }
                    },
                    {
                        extend: 'pdfHtml5',
                        exportOptions: {
                            columns: ':visible'
                        },
                        className: 'btn btn-danger btn-sm',
                        init: function (api, node, config) {
                            $(node).removeClass('btn-secondary')
                        },
                    }, {
                        extend: 'print',
                        className: 'btn-sm',
                        exportOptions: {
                            columns: ':visible'
                        }
                    }
                    ],
                    initComplete: function () {
                        this.api().columns().every(function () {
                            var column = this;
                            var select = $('<select class="form-control form-control-sm"><option value="-- Select --"></option></select>')
                                .appendTo($(column.footer()).empty())
                                .on('change', function () {
                                    var val = $.fn.dataTable.util.escapeRegex(
                                        $(this).val()
                                    );

                                    column
                                        .search(val ? '^' + val + '$' : '', true, false)
                                        .draw();
                                });

                            column.data().unique().sort().each(function (d, j) {
                                if (/^[a-zA-Z0-9- ]*$/.test(d) == true) {
                                    select.append('<option  value="' + d + '">' + d + '</option>')
                                    // alert('Your search string contains illegal characters.');
                                }
                            });
                        });

                        $('.data-table').fadeIn()
                        $('.dt-buttons').removeClass('btn-group')
                    }

                });
            }
        }


        (function ($) {
            $.fn.serializeObject = function () {

                var self = this,
                    json = {},
                    push_counters = {},
                    patterns = {
                        "validate": /^[a-zA-Z][a-zA-Z0-9_]*(?:\[(?:\d*|[a-zA-Z0-9_]+)\])*$/,
                        "key": /[a-zA-Z0-9_]+|(?=\[\])/g,
                        "push": /^$/,
                        "fixed": /^\d+$/,
                        "named": /^[a-zA-Z0-9_]+$/
                    };


                this.build = function (base, key, value) {
                    base[key] = value;
                    return base;
                };

                this.push_counter = function (key) {
                    if (push_counters[key] === undefined) {
                        push_counters[key] = 0;
                    }
                    return push_counters[key]++;
                };

                $.each($(this).serializeArray(), function () {

                    // Skip invalid keys
                    if (!patterns.validate.test(this.name)) {
                        return;
                    }

                    var k,
                        keys = this.name.match(patterns.key),
                        merge = this.value,
                        reverse_key = this.name;

                    while ((k = keys.pop()) !== undefined) {

                        // Adjust reverse_key
                        reverse_key = reverse_key.replace(new RegExp("\\[" + k + "\\]$"), '');

                        // Push
                        if (k.match(patterns.push)) {
                            merge = self.build([], self.push_counter(reverse_key), merge);
                        }

                        // Fixed
                        else if (k.match(patterns.fixed)) {
                            merge = self.build([], k, merge);
                        }

                        // Named
                        else if (k.match(patterns.named)) {
                            merge = self.build({}, k, merge);
                        }
                    }

                    json = $.extend(true, json, merge);
                });

                return json;
            };
        })(jQuery);
        function b_alert(type, message) {
            return `
                <div class="alert alert-${type} alert-dismissible fade show" role="alert">
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    ${message}
                </div>`
        }
        function b_input_modal(title, body_url) {
            $.ajax({ method: "GET", url: body_url, cache: false, dataType: "html" })
                .done(function (data) {
                    $('#input_modal .modal-title').html(title)
                    $('#input_modal .modal-body').html(data)
                    $('#input_modal').modal('show');
                })
        }

        function b_edit_modal(id, title, body_url) {
            $.ajax({ method: "GET", url: body_url, cache: false, dataType: "html" })
                .done(function (data) {
                    $('#input_modal').attr('data-edit-id', id)
                    $('#input_modal .modal-title').html(title)
                    $('#input_modal .modal-body').html(data)
                    $('#input_modal').modal('show');
                })
        }
        function percentage(a, b) {
            return (Number(a) / 100) * Number(b);
        }

        $(document).ready(function () {

            $.ajax({ method: 'GET', url: './api/connect.php?get', asysnc: false, cache: false, dataType: 'json' })
                .done(function (response) {
                    $('.page').hide();
                    if (response.session_established) {
                        $('.page').fadeIn().load('panel.html')
                    } else {
                        $('.page').fadeIn().load('login.html')
                    }
                }).fail(function (e) {
                    $('.page').fadeIn().load('server.html')
                })

            $(document).keydown(function (event) {
                if (event.ctrlKey == true && (event.which == '80')) { //cntrl + p
                    event.preventDefault();
                    printAssessment();
                }
            });
            $(document).on('click', '.print_preview', function (e) {
                e.preventDefault();
                printAssessment();
            })

            function printAssessment() {

                // alert("Print the little page");
                // print();
                $('#print_modal').modal('show');
            }

            $(document).on('submit', "#vendor_add_form", function (e) {

                e.preventDefault(); // avoid to execute the actual submit of the form.

                var form = $(this);

                $.ajax({
                    type: "POST",
                    url: './api/vendor_crud.php?crud=insert',
                    data: form.serialize(), // serializes the form's elements.
                    dataType: 'json',
                }).done(function (response) {
                    console.log(response); // show response from the php script.
                    if (response.inserted) {
                        $('#input_modal').modal('hide');
                        table_data();
                    } else {
                        console.log('error');
                    }
                });
            });

            $(document).on('click', '.btn-print', function () {
                print();
            })
            $(document).on('submit', "#product_add_form", function (e) {

                e.preventDefault(); // avoid to execute the actual submit of the form.

                var form = $(this);

                $.ajax({
                    type: "POST",
                    url: './api/product_crud.php?crud=insert',
                    data: form.serialize(), // serializes the form's elements.
                    dataType: 'json'
                }).done(function (response) {
                    console.log(response); // show response from the php script.
                    if (response.inserted) {
                        table_data();
                    } else {
                        console.log('error');
                    }
                    $('#input_modal').modal('hide');
                });
            });

        })
    </script>
    <style>
        @media print {
            body * {
                visibility: hidden;
            }

            #section-to-print,
            #section-to-print * {
                visibility: visible;
            }

            #section-to-print {
                position: fixed;
                top: 0;
                left: 0;
            }
        }
    </style>
    <div class="modal fade rounded" id="print_modal" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="true" aria-labelledby="modelTitleId" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-top" role="document">
            <div class="modal-content border-0">
                <div class="modal-header border-0 py-1 text-light" style="background: linear-gradient(45deg,#4a7db4,#7d87ea);">
                    <h6 class="modal-title"><i class="fa fa-print"></i> Print Preview</h6>
                    <button type="button" class="close text-light" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="p-2"><button class="btn btn-dark btn-print"><i class="fa fa-print"></i></button></div>
                <div class="modal-body print-holder">
                    <div class="print-view">
                        <div class="print-content" id="section-to-print"> Print Preview</span>
                        </div>
                    </div>
                </div>
                <style>
                    .print-holder {
                        background: #525659;
                    }

                    .print-view {
                        background: #fff;
                        padding: 1rem;
                        height: 297mm;
                        width: 210mm;
                        margin: auto;
                    }

                    .dummy-content {
                        height: 400px;
                        width: 500px;
                        background: black;
                        display: block;
                    }
                </style>
            </div>
        </div>
    </div>
    <!-- Modal -->
    <div class="modal fade" data-edit-id="" id="input_modal" tabindex="-1" role="dialog" data-backdrop="static"
         data-keyboard="false" aria-labelledby="modelTitleId" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">title</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body"> Body </div>
            </div>
        </div>
    </div>
    <!-- Page level plugins -->
    <script src=".assets/vendor/chart.js/Chart.min.js"></script>
    <link rel="stylesheet" type="text/css"
          href="https://cdn.datatables.net/v/bs4/jszip-2.5.0/dt-1.10.21/af-2.3.5/b-1.6.3/b-colvis-1.6.3/b-flash-1.6.3/b-html5-1.6.3/b-print-1.6.3/cr-1.5.2/fc-3.3.1/fh-3.1.7/kt-2.5.2/r-2.2.5/rg-1.1.2/rr-1.2.7/sc-2.0.2/sp-1.1.1/sl-1.3.1/datatables.min.css" />
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
    <script type="text/javascript"
            src="https://cdn.datatables.net/v/bs4/jszip-2.5.0/dt-1.10.21/af-2.3.5/b-1.6.3/b-colvis-1.6.3/b-flash-1.6.3/b-html5-1.6.3/b-print-1.6.3/cr-1.5.2/fc-3.3.1/fh-3.1.7/kt-2.5.2/r-2.2.5/rg-1.1.2/rr-1.2.7/sc-2.0.2/sp-1.1.1/sl-1.3.1/datatables.min.js"></script>
</body>